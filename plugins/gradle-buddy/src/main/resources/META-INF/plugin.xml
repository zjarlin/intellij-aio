<idea-plugin>
  <id>site.addzero.gradle-buddy</id>
  <name>Gradle Buddy</name>
  <vendor>AddZero</vendor>


  <!-- K2 Compatibility Declaration -->
  <idea-version since-build="242" until-build="262.*"/>

  <description>
    A plugin that helps you manage Gradle projects.

    Features:
    - Show Gradle tasks for current module in a tool window
    - Migrate project() dependencies to Maven artifacts
    - Migrate hardcoded dependencies to version catalog
    - Intention actions for updating dependencies
  </description>

  <depends>com.intellij.modules.platform</depends>
  <depends>org.jetbrains.kotlin</depends>
  <depends>org.jetbrains.plugins.gradle</depends>
  <depends>org.toml.lang</depends>
  <!-- K2 模式兼容性声明 -->
  <extensions defaultExtensionNs="org.jetbrains.kotlin">
    <supportsKotlinPluginMode supportsK2="true"/>
  </extensions>

  <!-- Intention: Update dependency to latest version (Gradle KTS) -->
  <!-- order="FIRST" 确保在intention列表中优先显示 -->
  <actions>
    <!-- Fix all plugin IDs in the project -->
    <action id="site.addzero.idfixer.FixAllPluginIdsAction"
            class="site.addzero.idfixer.FixAllPluginIdsAction"
            text="Fix All Build Script Plugin  Qualified IDs in Project"
            description="Scans all build-logic directories and fixes all plugin ID references to use fully qualified names.">
      <add-to-group group-id="ToolsMenu" anchor="last"/>
    </action>

    <!-- Version Catalog Floating Toolbar -->
    <group id="GradleBuddy.VersionCatalogFloatingToolbarGroup"
           text="Version Catalog"
           popup="false"/>

    <action id="GradleBuddy.OrganizeVersionCatalog"
            class="site.addzero.gradle.buddy.notification.OrganizeVersionCatalogAction"
            text="Organize"
            description="Sort and de-duplicate the version catalog"
            icon="/icons/gradleBannerIcon.svg">
      <add-to-group group-id="GradleBuddy.VersionCatalogFloatingToolbarGroup" anchor="first"/>
    </action>

    <action id="GradleBuddy.NormalizeVersionCatalog"
            class="site.addzero.gradle.buddy.notification.NormalizeVersionCatalogAction"
            text="Normalize"
            description="Normalize aliases and version.ref to use artifactId in kebab-case"
            icon="AllIcons.Actions.RefactoringBulb">
      <add-to-group group-id="GradleBuddy.VersionCatalogFloatingToolbarGroup" anchor="after" relative-to-action="GradleBuddy.OrganizeVersionCatalog"/>
    </action>

    <action id="GradleBuddy.FixBrokenCatalogReferences"
            class="site.addzero.gradle.buddy.notification.FixBrokenCatalogReferencesAction"
            text="Fix Broken References"
            description="Scan all .gradle.kts files and fix broken version catalog references"
            icon="AllIcons.Actions.QuickfixBulb">
      <add-to-group group-id="GradleBuddy.VersionCatalogFloatingToolbarGroup" anchor="after" relative-to-action="GradleBuddy.NormalizeVersionCatalog"/>
      <add-to-group group-id="ToolsMenu" anchor="last"/>
    </action>

    <action id="GradleBuddy.DismissVersionCatalogToolbar"
            class="site.addzero.gradle.buddy.notification.DismissVersionCatalogToolbarAction"
            text="Don't Remind"
            description="Hide the version catalog floating toolbar"
            icon="AllIcons.Actions.Close">
      <add-to-group group-id="GradleBuddy.VersionCatalogFloatingToolbarGroup" anchor="last"/>
    </action>

    <!-- Copy Module Dependency to clipboard (context menu) -->
    <action id="GradleBuddy.CopyModuleDependency"
            class="site.addzero.gradle.buddy.intentions.projectdep.CopyModuleDependencyAction"
            text="Copy Module Dependency"
            description="Copy implementation(project(&quot;...&quot;)) for current module to clipboard">
      <add-to-group group-id="EditorPopupMenu" anchor="last"/>
      <add-to-group group-id="EditorTabPopupMenu" anchor="last"/>
    </action>

    <!-- Migration: Replace project() dependencies with Maven artifacts -->
    <action id="GradleBuddy.MigrateProjectDependencies"
            class="site.addzero.gradle.buddy.migration.MigrateProjectDependenciesAction"
            text="Migrate project() Dependencies to Maven"
            description="Scan project() dependencies and replace them with Maven artifacts">
      <add-to-group group-id="ToolsMenu" anchor="last"/>
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
    </action>

    <!-- Migration: Migrate hardcoded dependencies to Version Catalog -->
    <action id="GradleBuddy.MigrateToVersionCatalog"
            class="site.addzero.gradle.buddy.migration.versioncatalog.MigrateToVersionCatalogAction"
            text="Migrate Dependencies to Version Catalog"
            description="Scan all .gradle.kts files and migrate hardcoded dependencies to libs.versions.toml">
      <add-to-group group-id="ToolsMenu" anchor="last"/>
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
    </action>

    <!-- Build-Logic: Resolve all plugin implementation artifacts -->
    <action id="GradleBuddy.ResolveAllPluginArtifacts"
            class="site.addzero.gradle.buddy.buildlogic.ResolveAllPluginArtifactsAction"
            text="Resolve All Plugin Artifacts for Build-Logic"
            description="Scan all plugins in .gradle.kts files and resolve their implementation artifacts to version catalog">
      <add-to-group group-id="ToolsMenu" anchor="last"/>
      <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
    </action>

    <!-- Favorite Tasks Floating Toolbar (shown on .gradle.kts / .gradle files) -->
    <group id="GradleBuddy.FavoriteTasksToolbarGroup"
           text="Favorite Tasks"
           popup="false"/>

    <action id="GradleBuddy.FavoriteTask.clean"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="clean" icon="AllIcons.Actions.GC">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.compileKotlin"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="compileKotlin" icon="AllIcons.Nodes.Module">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.build"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="build" icon="AllIcons.Actions.Compile">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.test"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="test" icon="AllIcons.RunConfigurations.TestPassed">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.jar"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="jar" icon="AllIcons.FileTypes.Archive">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.publishToMavenLocal"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="publishToMavenLocal" icon="AllIcons.Actions.Upload">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.publishToMavenCentral"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="publishToMavenCentral" icon="AllIcons.Nodes.Deploy">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.kspKotlin"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="kspKotlin" icon="AllIcons.Actions.RealIntentionBulb">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.kspCommonMainMetadata"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="kspCommonMainMetadata" icon="AllIcons.Actions.RealIntentionBulb">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.signPlugin"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="signPlugin" icon="AllIcons.Nodes.PpLib">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.publishPlugin"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="publishPlugin" icon="AllIcons.Actions.Upload">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>
    <action id="GradleBuddy.FavoriteTask.runIde"
            class="site.addzero.gradle.buddy.filter.RunFavoriteTaskAction"
            text="runIde" icon="AllIcons.Actions.Execute">
      <add-to-group group-id="GradleBuddy.FavoriteTasksToolbarGroup"/>
    </action>

  </actions>


  <extensions defaultExtensionNs="com.intellij">

    <postStartupActivity implementation="site.addzero.gradle.buddy.GradleBuddyPlugin"/>

    <!-- Notification Group -->
    <notificationGroup id="GradleBuddy" displayType="BALLOON" isLogByDefault="true"/>
    <notificationGroup id="Gradle Plugin ID Fixer" displayType="BALLOON" isLogByDefault="true"/>



    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.update.GradleKtsUpdateDependencyIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.select.SelectOtherVersionsIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Update dependency to latest version (Version Catalog TOML) -->
    <!-- order="FIRST" 确保在intention列表中优先显示 -->
    <intentionAction order="FIRST">
      <language>TOML</language>
      <className>site.addzero.gradle.buddy.intentions.catalog.VersionCatalogUpdateDependencyIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <intentionAction order="FIRST">
      <language>TOML</language>
      <className>site.addzero.gradle.buddy.intentions.catalog.VersionCatalogSelectOtherVersionsIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Update version variable to latest (Version Catalog [versions] section) -->
    <!-- order="FIRST" 确保在intention列表中优先显示 -->
    <intentionAction order="FIRST">
      <language>TOML</language>
      <className>site.addzero.gradle.buddy.intentions.catalog.VersionCatalogUpdateVersionIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Fix version - create dedicated version ref for artifact -->
    <intentionAction order="FIRST">
      <language>TOML</language>
      <className>site.addzero.gradle.buddy.intentions.catalog.VersionCatalogFixVersionIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert all module= to group= name= in version catalog -->
    <intentionAction order="FIRST">
      <language>TOML</language>
      <className>site.addzero.gradle.buddy.intentions.catalog.VersionCatalogModuleToGroupNameIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert plugin declaration to TOML format -->
    <!-- order="FIRST" 确保在intention列表中优先显示 -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.convert.GradleKtsPluginToTomlIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert hardcoded plugin to catalog alias -->
    <!-- order="FIRST" 确保在intention列表中优先显示 -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.convert.GradleKtsPluginToAliasIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert hardcoded dependency to TOML format -->
    <!-- order="FIRST" 确保在intention列表中优先显示 -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.convert.GradleKtsHardcodedDependencyToTomlIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert version catalog reference to hardcoded dependency -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.convert.GradleKtsCatalogDependencyToHardcodedIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Create bundle from selected catalog dependencies -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.convert.CreateBundleFromDependenciesIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Insert project dependency (select nearby module) -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.intentions.projectdep.InsertProjectDependencyIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Fix plugin ID to use fully qualified name -->
    <intentionAction order="FIRST">
      <className>site.addzero.idfixer.FixPluginIdIntention</className>
      <category>Gradle Plugin ID</category>
    </intentionAction>

    <!-- Intention: Select catalog reference from candidates (context menu) -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.catalog.SelectCatalogReferenceIntentionGroup</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Browse catalog alternatives (even for valid references) -->
    <intentionAction order="NORMAL">
      <language>kotlin</language>
      <className>site.addzero.gradle.catalog.BrowseCatalogAlternativesIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Convert id("...") to alias(libs.plugins.xxx) in plugins {} block -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.catalog.ConvertPluginIdToAliasIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Intention: Resolve plugin implementation artifact for build-logic -->
    <intentionAction order="FIRST">
      <language>kotlin</language>
      <className>site.addzero.gradle.buddy.buildlogic.ResolvePluginArtifactIntention</className>
      <category>Gradle Buddy</category>
    </intentionAction>

    <!-- Inspection: Invalid catalog reference -->
    <localInspection
            language="kotlin"
            shortName="InvalidCatalogReference"
            displayName="无效的版本目录引用"
            groupName="Gradle"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="site.addzero.gradle.catalog.InvalidCatalogReferenceInspection"/>

    <!-- Inspection: Deprecated catalog artifact usage in .gradle.kts -->
    <localInspection
            language="kotlin"
            shortName="DeprecatedCatalogArtifact"
            displayName="已弃用的版本目录依赖"
            groupName="Gradle"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="site.addzero.gradle.buddy.linemarker.DeprecatedArtifactInspection"/>

    <!-- Completion: Gradle Kotlin Script dependencies (order=FIRST 确保置顶) -->
    <completion.contributor language="kotlin" order="FIRST"
                            implementationClass="site.addzero.gradle.buddy.intentions.completion.GradleKtsCompletionContributor"/>

    <!-- Completion: Version Catalog TOML (order=FIRST 确保置顶) -->
    <completion.contributor language="any" order="FIRST"
                            implementationClass="site.addzero.gradle.buddy.intentions.completion.VersionCatalogCompletionContributor"/>

    <!-- Line Marker: gutter icons for version catalog libraries -->
    <codeInsight.lineMarkerProvider language="TOML"
                                    implementationClass="site.addzero.gradle.buddy.linemarker.VersionCatalogLineMarkerProvider"/>

    <!-- Deprecated Artifact Cache (application-level, cross-project) -->
    <applicationService serviceImplementation="site.addzero.gradle.buddy.linemarker.DeprecatedArtifactService"/>

    <!-- Floating toolbar for Version Catalog -->
    <editorFloatingToolbarProvider implementation="site.addzero.gradle.buddy.notification.VersionCatalogFloatingToolbarProvider"/>

    <!-- Floating toolbar for Favorite Gradle Tasks -->
    <editorFloatingToolbarProvider implementation="site.addzero.gradle.buddy.filter.FavoriteTasksFloatingToolbarProvider"/>

    <!-- Auto-focus official Gradle tool window to current module on editor tab switch -->
    <postStartupActivity implementation="site.addzero.gradle.buddy.filter.GradleAutoFocusStartupActivity"/>

    <!-- Settings -->
    <projectConfigurable
      parentId="tools"
      instance="site.addzero.gradle.buddy.settings.GradleBuddySettingsConfigurable"
      id="site.addzero.gradle.buddy.settings"
      displayName="Gradle Buddy"/>

    <!-- Status Bar Widget -->
    <statusBarWidgetFactory id="GradleBuddyWidget"
                            implementation="site.addzero.gradle.buddy.GradleBuddyWidgetFactory"/>

    <!-- Gradle Build Error Listener: registered programmatically via GradleBuildErrorListenerRegistrar -->

    <postStartupActivity implementation="site.addzero.gradle.buddy.notification.GradleBuildErrorListenerRegistrar"/>

  </extensions>


</idea-plugin>
