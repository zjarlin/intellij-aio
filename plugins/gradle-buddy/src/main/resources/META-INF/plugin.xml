<idea-plugin>
    <id>site.addzero.gradle-buddy</id>
    <name>Gradle Buddy</name>
    <vendor>AddZero</vendor>

    <!-- K2 Compatibility Declaration -->
    <idea-version since-build="242" until-build="262.*"/>

    <description>
        A plugin that helps you manage Gradle projects by showing an indicator when a project is not loaded.
        When you open a file in a Gradle project that hasn't been loaded, it shows an indicator in the status bar
        to remind you to load the Gradle project.

        Features:
        - On-demand module loading
        - Auto-release unused modules
        - Migrate project() dependencies to Maven artifacts
    </description>

    <depends>com.intellij.modules.platform</depends>
    <depends>org.jetbrains.plugins.gradle</depends>
    <depends>org.jetbrains.kotlin</depends>
    <!-- K2 模式兼容性声明 -->
    <extensions defaultExtensionNs="org.jetbrains.kotlin">
        <supportsKotlinPluginMode supportsK2="true" />
    </extensions>

    <extensions defaultExtensionNs="com.intellij">

        <postStartupActivity implementation="site.addzero.gradle.buddy.GradleBuddyPlugin"/>

        <!-- Notification Group -->
        <notificationGroup id="GradleBuddy" displayType="BALLOON" isLogByDefault="true"/>

        <!-- Intention: Update dependency to latest version (Gradle KTS) -->
        <!-- order="FIRST" 确保在intention列表中优先显示 -->
        <intentionAction order="FIRST">
            <language>kotlin</language>
            <className>site.addzero.gradle.buddy.intentions.GradleKtsUpdateDependencyIntention</className>
            <category>Gradle Buddy</category>
        </intentionAction>

        <!-- Intention: Update dependency to latest version (Version Catalog TOML) -->
        <!-- order="FIRST" 确保在intention列表中优先显示 -->
        <intentionAction order="FIRST">
            <language>kotlin</language>
            <className>site.addzero.gradle.buddy.intentions.VersionCatalogUpdateDependencyIntention</className>
            <category>Gradle Buddy</category>
        </intentionAction>

        <!-- Intention: Convert plugin declaration to TOML format -->
        <!-- order="FIRST" 确保在intention列表中优先显示 -->
        <intentionAction order="FIRST">
            <language>kotlin</language>
            <className>site.addzero.gradle.buddy.intentions.GradleKtsPluginToTomlIntention</className>
            <category>Gradle Buddy</category>
        </intentionAction>

        <!-- Intention: Convert hardcoded dependency to TOML format -->
        <!-- order="FIRST" 确保在intention列表中优先显示 -->
        <intentionAction order="FIRST">
            <language>kotlin</language>
            <className>site.addzero.gradle.buddy.intentions.GradleKtsHardcodedDependencyToTomlIntention</className>
            <category>Gradle Buddy</category>
        </intentionAction>

        <!-- Current Module Tasks Tool Window -->
        <toolWindow id="Module Tasks"
                    anchor="right"
                    secondary="true"
                    icon="/icons/moduleTasksIcon.svg"
                    factoryClass="site.addzero.gradle.buddy.filter.CurrentModuleGradleTasksToolWindowFactory"/>

        <!-- Settings -->
        <projectConfigurable
            parentId="tools"
            instance="site.addzero.gradle.buddy.settings.GradleBuddySettingsConfigurable"
            id="site.addzero.gradle.buddy.settings"
            displayName="Gradle Buddy"/>

        <!-- Status Bar Widget -->
        <statusBarWidgetFactory id="GradleBuddyWidget"
                                implementation="site.addzero.gradle.buddy.GradleBuddyWidgetFactory"/>

        <!-- Version Catalog Editor Notification -->
        <editorNotificationProvider implementation="site.addzero.gradle.buddy.catalog.VersionCatalogEditorNotificationProvider"/>
    </extensions>

    <actions>
        <action id="GradleBuddy.MigrateProjectDependencies"
                class="site.addzero.gradle.buddy.migration.MigrateProjectDependenciesAction"
                text="Migrate project() to Maven Dependencies"
                description="Scan project() dependencies and replace them with Maven artifacts">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </action>

        <action id="GradleBuddy.MigrateToVersionCatalog"
                class="site.addzero.gradle.buddy.catalog.MigrateToVersionCatalogAction"
                text="Migrate to Version Catalog"
                description="Migrate hardcoded dependencies to gradle/libs.versions.toml">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </action>

    </actions>


</idea-plugin>
